```{r}
library(Matrix)
library(dplyr)
library(Seurat)
library(ggplot2)
```


```{r}
# Import file
pbmc
```
```{r}
pbmc@meta.data
```

```{r}
# Filter out low quality reads using selected thresholds - these will change with experiment
filtered_pbmc <- subset(x = pbmc, 
                         subset= (nCount_RNA >= 500) & 
                           (nFeature_RNA >= 250) & 
                            (nFeature_RNA < 2500) & 
                           (log10GenesPerUMI > 0.80) & 
                           (mitoRatio < 0.20))
			     
```

GENE LEVEL FILTERING

```{r}
# Output a logical vector for every gene on whether the more than zero counts per cell
# Extract counts
counts <- GetAssayData(object = filtered_pbmc, slot = "counts")

# Output a logical vector for every gene on whether the more than zero counts per cell
nonzero <- counts > 0

# Sums all TRUE values and returns TRUE if more than 10 TRUE values per gene
keep_genes <- Matrix::rowSums(nonzero) >= 10

# Only keeping those genes expressed in more than 10 cells
filtered_counts <- counts[keep_genes, ]

# Reassign to filtered Seurat object
filtered_pbmc <- CreateSeuratObject(filtered_counts, meta.data = filtered_pbmc@meta.data)
```

